@echo off
chcp 65001 >nul
echo ==========================================
echo üöÄ WagerPlay - –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
echo ==========================================
echo.

REM –£–±–∏–≤–∞–µ–º —Å—Ç–∞—Ä—ã–π –ø—Ä–æ—Ü–µ—Å—Å –Ω–∞ –ø–æ—Ä—Ç—É 3000 –µ—Å–ª–∏ –µ—Å—Ç—å
echo üßπ –û—á–∏—Å—Ç–∫–∞ –ø–æ—Ä—Ç–∞ 3000...
for /f "tokens=5" %%a in ('netstat -ano ^| findstr :3000') do (
    taskkill /F /PID %%a 2>nul
    echo ‚úÖ –û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Å—Ç–∞—Ä—ã–π –ø—Ä–æ—Ü–µ—Å—Å (PID: %%a)
)

REM –ü—Ä–æ–≤–µ—Ä—è–µ–º Docker
echo üê≥ –ü—Ä–æ–≤–µ—Ä–∫–∞ Docker...
docker info >nul 2>&1
if errorlevel 1 (
    echo ‚ùå Docker –Ω–µ –∑–∞–ø—É—â–µ–Ω! –ó–∞–ø—É—Å—Ç–∏ Docker Desktop.
    pause
    exit /b 1
)

REM –ó–∞–ø—É—Å–∫–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
echo üê≥ –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ PostgreSQL –∏ Redis...
docker-compose up -d

if errorlevel 1 (
    echo ‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤!
    pause
    exit /b 1
)

echo ‚úÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—â–µ–Ω—ã!
echo.

REM –ñ–¥—ë–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ PostgreSQL
echo ‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (5 —Å–µ–∫)...
timeout /t 5 /nobreak >nul

REM –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç
docker ps | findstr wagerplay >nul
if errorlevel 1 (
    echo ‚ùå –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –Ω–µ –∑–∞–ø—É—â–µ–Ω—ã!
    pause
    exit /b 1
)

echo ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≥–æ—Ç–æ–≤–∞!
echo.

REM –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
echo üöÄ –ó–∞–ø—É—Å–∫ NestJS —Å–µ—Ä–≤–µ—Ä–∞...
echo ==========================================
npm run start:dev

pause
